{% extends 'overall/layout' %}
{% block appHeader %}

        <div id="navbar">

        <nav class="navbar navbar-expand-sm bg-dark navbar-dark">
          <!-- Brand -->
          <a class="navbar-brand" href="http://localhost/HomeSwitchHome/"><div><img src="app/img/HSH-Text.jpg" class="img-responsive" title="Logo Home Switch Home" style="width:180px;"></div></a>

          <!-- Links -->
          <ul class="navbar-nav">
            <li class="nav-item">
              <a class="nav-link" href="http://localhost/HomeSwitchHome/usuarios/logout"><span class="glyphicon glyphicon-log-in"></span>   Cerrar Sesion</a>
            </li>

            <!-- Dropdown -->
            <li class="nav-item dropdown">
              <a class="nav-link dropdown-toggle my-2 my-lg-0" href="#" id="navbardrop" data-toggle="dropdown">
                More
              </a>
              <div class="dropdown-menu">
                <a class="dropdown-item" href="#"><span class="glyphicon glyphicon-question-sign"> FAQs</a>
                <a class="dropdown-item" href="#"><span class="glyphicon glyphicon-envelope"> Contacto</a>
                <a class="dropdown-item" href="#"><span class="glyphicon glyphicon-fire"></span> Subastas</a>
                <a class="dropdown-item" href="#"><span class="glyphicon glyphicon-fire"></span> Hotsales</a>
              </div>
            </li>
          </ul>
        </nav>

        </div> 
{% endblock %}

{% block carrousel %}
{% endblock %}

{% block appContenido %}    
		
  {% if operacion == 1 %}
      <div class="alert alert-success alert-dismissible">
        <button type="button" class="close" data-dismiss="alert">&times;</button>
        <strong class="animated flash"> <span class='glyphicon glyphicon-ok-sign'></span> Nota:</strong> La puja se ha registrado con éxito!
      </div>
  {% endif %}

	<div id="div_detalle" class="border container">

	   	<h2 class="detalle">Detalles de la subasta</h2>

      <div class="col-lg-8">


  	    <div class_"row">

  	      <ul class="list-group list-group-flush">
            <li class="list-group-item"><span class="glyphicon glyphicon-ok"></span> <strong> Residencia: </strong>{{ subasta.nombre }}</li>
  	        <li class="list-group-item"><span class="glyphicon glyphicon-map-marker"></span><strong> Dirección:</strong> {{ subasta.calle }} {{ subasta.altura }}, {{ subasta.ciudad }}, {{ subasta.provincia }}</li>
  	        <li class="list-group-item"><span class="glyphicon glyphicon-user"></span> <strong>Capacidad:</strong> {{ subasta.capacidad }}</li>      
            <li class="list-group-item"><span class="glyphicon glyphicon-ok"></span> <strong> Semana: </strong>{{ subasta.semana }}</li>
            <li class="list-group-item"><span class="glyphicon glyphicon-usd"></span> <strong> Monto original de la estadía: </strong><strike>${{ subasta.monto_estadia|number_format(2, ',', '.') }}</strike></li>

            {% set porcentaje = (1 - (subasta.monto_subasta / subasta.monto_estadia)) * 100 %}

              <li id="descuento" class="list-group-item">
                <div class="row">
                  <span class="glyphicon glyphicon-fire"></span> <strong> &nbsp;Monto inicial de la subasta: </strong>${{ subasta.monto_subasta|number_format(2, ',', '.') }}
                  <p id="descuento"> &nbsp;&nbsp;&nbsp;{{ porcentaje|number_format(2) }}% OFF</p>
                </div>
              </li>

  	      </ul> 

    
          <h2 id="pujas">Pujas</h2>
            <ul class="list-group list-group-flush">      
              
              {% if puja.usuario_id != null %}

                  {% set monto_validacion = puja.monto_apostado %}

                  <li class="list-group-item"><span class="glyphicon glyphicon-usd"></span> <strong> Monto actual de la subasta: </strong>${{ puja.monto_apostado|number_format(2, ',', '.') }}</li>
                  <li class="list-group-item"><span class="glyphicon glyphicon-user"></span> <strong> Usuario: </strong>{{ puja.apellido }}, {{ puja.nombre }}</li>
                  <li class="list-group-item">

              {% else %}

                  {% set monto_validacion = subasta.monto_subasta %}

                  <li class="list-group-item"><span class="glyphicon glyphicon-usd"></span> Aún no existen pujas, podés ser el primero!</li>
              {% endif %}

                
                <form action="http://localhost/HomeSwitchHome/subastas/pujar/{{ subasta.id_subasta }}" onsubmit="return validarPuja({{ monto_validacion }});" enctype="multipart/form-data" method="post">
                  
                      <label for="puja">Monto:</label>                      
                      <input type="text" id="puja" name="puja"> 
                                     
                    <button id="pujar" type="submit" class="btn btn-secondary my-2">Pujar!</button>
                    <p class="animated shake" id="errorPujaVacia" name="errorPujaVacia"><span class="glyphicon glyphicon-exclamation-sign"></span> Complete este campo.</p>
                    <p class="animated shake" id="errorPujaMonto" name="errorPujaMonto"><span class="glyphicon glyphicon-exclamation-sign"></span> Debe ingresar un valor mayor al actual!</p>
                  
                </form>
              </li>
            </ul>
        </div>

      </div>
      <div id="img_detalle_residencia" class="col-lg-4">
        <img id="foto_detalle_residencia" src="{{ subasta.foto }}" class="perfil float-right" alt="Foto de perfil"> 
      </div>

 	</div>
		


{% endblock %}

{% block appBody %}
{% endblock %}